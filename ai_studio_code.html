<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime IPTV Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root {
            --bg: #0b1115;
            --surface: #1a242f;
            --prime-blue: #00a8e1;
            --text: #ffffff;
            --text-dim: #8197a4;
        }

        body, html {
            margin: 0; padding: 0; background: var(--bg); color: var(--text);
            font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh;
        }

        nav {
            position: fixed; top: 0; left: 0; right: 0; height: 70px;
            display: flex; align-items: center; padding: 0 50px;
            background: linear-gradient(to bottom, rgba(15,23,30,1), transparent); z-index: 1000;
        }
        .nav-item { margin-right: 25px; font-weight: bold; color: var(--text-dim); cursor: pointer; }
        .nav-item.active { color: white; border-bottom: 3px solid var(--prime-blue); }

        .view { position: absolute; inset: 0; display: none; overflow-y: auto; overflow-x: hidden; padding-bottom: 50px; }
        .view.active { display: block; }

        /* HERO AREA */
        .hero-banner {
            height: 75vh; width: 100%; position: relative;
            background-size: cover; background-position: center;
            display: flex; align-items: center; padding: 0 60px;
            transition: background 0.8s ease;
        }
        .hero-banner::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to right, var(--bg) 15%, transparent 70%),
                        linear-gradient(to top, var(--bg) 0%, transparent 30%);
        }
        .hero-info { position: relative; z-index: 10; max-width: 600px; }

        /* ROWS (PRIME STYLE) */
        .row-section { margin-top: -120px; position: relative; z-index: 20; padding-left: 50px; }
        .row-title { font-size: 1.3rem; font-weight: bold; margin: 30px 0 10px 10px; color: #fff; }
        
        .row-scroller {
            display: flex; gap: 15px; overflow-x: auto; padding: 10px;
            scrollbar-width: none; scroll-behavior: smooth;
        }
        .row-scroller::-webkit-scrollbar { display: none; }

        .prime-card {
            min-width: 280px; height: 158px; /* 16:9 Aspect Ratio */
            background: var(--surface); border-radius: 6px; cursor: pointer;
            transition: transform 0.3s ease, border 0.3s ease;
            background-size: cover; background-position: center;
            border: 3px solid transparent; flex-shrink: 0;
        }
        .prime-card:hover { transform: scale(1.1); border-color: white; z-index: 100; }

        /* DETAILS OVERLAY */
        #details-view {
            position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none;
            padding: 80px 60px; overflow-y: auto;
        }

        /* UTILS */
        .btn-play { background: #fff; color: #000; padding: 12px 30px; border-radius: 4px; font-weight: bold; border: none; cursor: pointer; }
        .loader { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <nav>
        <div class="nav-item active" onclick="openPage('home')">Home</div>
        <div class="nav-item" onclick="openPage('movies')">Movies</div>
        <div class="nav-item" onclick="openPage('shows')">TV Shows</div>
        <div class="nav-item" onclick="openPage('login')">Setup</div>
    </nav>

    <div id="loading" class="loader"><h1>Connecting to Prime...</h1></div>

    <!-- HOME VIEW -->
    <div id="view-home" class="view active">
        <div class="hero-banner" id="home-hero">
            <div class="hero-info">
                <h1 id="hero-title" style="font-size: 3.5rem; margin: 0;">Loading...</h1>
                <p id="hero-desc" style="color: var(--text-dim); margin: 20px 0; font-size: 1.1rem; line-height: 1.5;"></p>
                <button class="btn-play">▶ Watch Now</button>
            </div>
        </div>

        <div class="row-section">
            <div class="row-title">Trending Now (TMDB)</div>
            <div class="row-scroller" id="row-trending"></div>

            <div class="row-title">Popular Action Movies</div>
            <div class="row-scroller" id="row-action"></div>

            <div class="row-title">Recently Added on Server</div>
            <div class="row-scroller" id="row-server"></div>
        </div>
    </div>

    <!-- GRID VIEW (Used for Category Lists) -->
    <div id="view-grid" class="view">
        <h1 id="grid-header" style="padding: 100px 60px 20px;">Categories</h1>
        <div id="grid-content" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:20px; padding: 0 60px;"></div>
    </div>

    <!-- LOGIN VIEW -->
    <div id="view-login" class="view">
        <div style="max-width:400px; margin: 150px auto; background:var(--surface); padding:40px; border-radius:8px;">
            <h2>Xtream Login</h2>
            <input type="text" id="iptv_url" placeholder="URL" style="width:100%; padding:10px; margin:10px 0;">
            <input type="text" id="iptv_user" placeholder="User" style="width:100%; padding:10px; margin:10px 0;">
            <input type="password" id="iptv_pass" placeholder="Pass" style="width:100%; padding:10px; margin:10px 0;">
            <button class="btn-play" style="width:100%" onclick="connect()">CONNECT</button>
        </div>
    </div>

    <!-- DETAILS VIEW -->
    <div id="details-view">
        <button onclick="document.getElementById('details-view').style.display='none'" style="color:white; background:none; border:1px solid #fff; padding:10px; cursor:pointer">⬅ Back</button>
        <div style="display:flex; gap:50px; margin-top:40px;">
            <img id="det-poster" src="" style="width:300px; border-radius:8px;">
            <div>
                <h1 id="det-title" style="font-size:4rem; margin:0"></h1>
                <p id="det-plot" style="font-size:1.2rem; color:#ccc; max-width:800px; margin-top:30px;"></p>
                <button id="det-play" class="btn-play" style="margin-top:20px; background:var(--prime-blue); color:white;">▶ PLAY STREAM</button>
            </div>
        </div>
    </div>

<script>
    const TMDB_KEY = "c78abeb00aa64f93fd7b516cb9bd180e";
    const PROXY = "https://layasync-proxy.layasync.workers.dev/?url=";
    let auth = null;

    function openPage(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        if(id === 'home') loadHomeData();
    }

    async function connect() {
        auth = {
            url: document.getElementById('iptv_url').value,
            user: document.getElementById('iptv_user').value,
            pass: document.getElementById('iptv_pass').value
        };
        openPage('home');
    }

    // --- HOME PAGE RECOMMENDATION ENGINE ---
    async function loadHomeData() {
        document.getElementById('loading').style.display = 'flex';
        
        // 1. Fetch Trending from TMDB for the Hero & Row 1
        const tmdbRes = await fetch(`https://api.themoviedb.org/3/trending/movie/week?api_key=${TMDB_KEY}`);
        const tmdbData = await tmdbRes.json();
        const trending = tmdbData.results;

        // Set Hero
        const hero = trending[0];
        document.getElementById('home-hero').style.backgroundImage = `url(https://image.tmdb.org/t/p/original${hero.backdrop_path})`;
        document.getElementById('hero-title').innerText = hero.title;
        document.getElementById('hero-desc').innerText = hero.overview;

        // Fill Trending Row
        fillRow('row-trending', trending);

        // 2. Fetch Action Movies from TMDB for Row 2
        const actionRes = await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_KEY}&with_genres=28`);
        const actionData = await actionRes.json();
        fillRow('row-action', actionData.results);

        // 3. Fetch "New" from Xtream Server (if connected)
        if (auth) {
            const serverRes = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=get_vod_streams`));
            const serverData = await serverRes.json();
            fillRow('row-server', serverData.slice(0, 20), true);
        }

        document.getElementById('loading').style.display = 'none';
    }

    function fillRow(containerId, items, isXtream = false) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'prime-card';
            const img = isXtream ? (item.stream_icon || item.cover) : `https://image.tmdb.org/t/p/w500${item.backdrop_path || item.poster_path}`;
            card.style.backgroundImage = `url(${img})`;
            card.onclick = () => showDetails(item, isXtream);
            container.appendChild(card);
        });
    }

    async function showDetails(item, isXtream) {
        const view = document.getElementById('details-view');
        view.style.display = 'block';
        
        if (!isXtream) {
            // If clicked a TMDB recommendation, we show info
            document.getElementById('det-title').innerText = item.title;
            document.getElementById('det-plot').innerText = item.overview;
            document.getElementById('det-poster').src = `https://image.tmdb.org/t/p/w500${item.poster_path}`;
            document.getElementById('det-play').innerText = "SEARCH ON SERVER";
        } else {
            // If clicked server content, we show and play
            document.getElementById('det-title').innerText = item.name;
            document.getElementById('det-plot').innerText = "Direct content from your IPTV server.";
            document.getElementById('det-poster').src = item.stream_icon || item.cover;
            document.getElementById('det-play').innerText = "▶ WATCH NOW";
        }
    }

    // Initialize
    setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
    }, 1500);
</script>
</body>
</html>