<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONYX IPTV PREMIUM</title>
    <!-- Premium Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-base: #060d14;
            --bg-surface: #101a23;
            --accent: #1a98ff;
            --accent-glow: rgba(26, 152, 255, 0.4);
            --text-primary: #f2f4f6;
            --text-secondary: #8197a4;
            --card-radius: 12px;
            --transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        body, html {
            margin: 0; padding: 0; background: var(--bg-base); color: var(--text-primary);
            font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh;
        }

        /* --- SIDEBAR: CLEAN & MINIMAL --- */
        aside {
            position: fixed; left: 0; top: 0; bottom: 0; width: 90px;
            background: rgba(6, 13, 20, 0.8); backdrop-filter: blur(20px);
            display: flex; flex-direction: column; align-items: center; 
            padding-top: 40px; z-index: 1000; border-right: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item {
            width: 54px; height: 54px; margin-bottom: 25px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            border-radius: 16px; transition: var(--transition);
            color: var(--text-secondary);
        }
        .nav-item:hover, .nav-item.active {
            color: var(--accent); background: rgba(26, 152, 255, 0.1);
            box-shadow: 0 0 20px var(--accent-glow);
        }
        .nav-item svg { width: 26px; height: 26px; fill: currentColor; }

        /* --- VIEW MANAGEMENT --- */
        main { margin-left: 90px; height: 100vh; overflow-y: auto; position: relative; scrollbar-width: none; }
        .view { display: none; padding: 40px 60px; min-height: 100vh; box-sizing: border-box; }
        .view.active { display: block; animation: slideUp 0.6s ease forwards; }

        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* --- CINEMATIC HERO --- */
        .hero {
            height: 75vh; margin: -40px -60px 40px -60px; position: relative;
            background-size: cover; background-position: center; display: flex; align-items: center; padding: 0 80px;
        }
        .hero::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(90deg, var(--bg-base) 10%, transparent 70%),
                        linear-gradient(0deg, var(--bg-base) 0%, transparent 50%);
        }
        .hero-content { position: relative; z-index: 10; max-width: 700px; }
        .hero-title { font-size: 4.5rem; font-weight: 800; margin: 0; letter-spacing: -2px; }
        .badge { background: var(--accent); padding: 4px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 800; vertical-align: middle; }

        /* --- PREMIUM CARDS & ROWS --- */
        .row-label { font-size: 1.6rem; font-weight: 700; margin: 40px 0 20px 0; display: flex; align-items: center; gap: 15px; }
        .row-label::before { content: ''; width: 4px; height: 24px; background: var(--accent); border-radius: 2px; }

        .scroller { display: flex; gap: 20px; overflow-x: auto; padding: 15px 5px; scrollbar-width: none; }
        
        .premium-card {
            min-width: 300px; height: 169px; background: var(--bg-surface);
            border-radius: var(--card-radius); cursor: pointer; position: relative;
            transition: var(--transition); background-size: cover; background-position: center;
            border: 2px solid rgba(255,255,255,0.05); flex-shrink: 0;
            display: flex; align-items: flex-end;
        }
        .premium-card:hover { 
            transform: scale(1.08) translateY(-10px); border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 15px var(--accent-glow);
        }
        .card-overlay { 
            width: 100%; padding: 20px; background: linear-gradient(0deg, rgba(0,0,0,0.9), transparent);
            border-bottom-left-radius: var(--card-radius); border-bottom-right-radius: var(--card-radius);
            font-weight: 600; font-size: 0.9rem;
        }

        /* --- CATEGORY GRID --- */
        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-top: 30px; }
        .cat-item {
            height: 120px; background: var(--bg-surface); border-radius: var(--card-radius);
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 700;
            border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: var(--transition);
        }
        .cat-item:hover { background: var(--accent); color: white; transform: translateY(-5px); }

        /* --- LOGIN PAGE --- */
        .login-wrap { display: flex; align-items: center; justify-content: center; height: 80vh; }
        .login-card { background: var(--bg-surface); padding: 50px; border-radius: 24px; width: 420px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        input { 
            width: 100%; padding: 18px; margin: 12px 0; background: #060d14; border: 1px solid rgba(255,255,255,0.1);
            color: white; border-radius: 12px; box-sizing: border-box; font-size: 1rem; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); background: #0a1622; }
        .btn-premium { 
            width: 100%; padding: 18px; background: var(--accent); color: white; border: none;
            font-weight: 800; cursor: pointer; border-radius: 12px; margin-top: 25px; font-size: 1rem; letter-spacing: 1px;
        }

        /* --- PLAYER --- */
        #player-layer { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; }
        .loader { position: fixed; inset: 0; background: var(--bg-base); z-index: 9999; display: flex; align-items: center; justify-content: center; font-weight: 800; letter-spacing: 4px; color: var(--accent); }
    </style>
</head>
<body>

    <aside>
        <div class="nav-item active" onclick="navTo('home')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
        <div class="nav-item" onclick="navTo('movies')"><svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg></div>
        <div class="nav-item" onclick="navTo('shows')"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg></div>
        <div class="nav-item" onclick="navTo('login')"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></div>
    </aside>

    <div id="loading" class="loader">ONYX PREMIUM</div>

    <main id="main-scroller">
        <!-- HOME VIEW -->
        <section id="view-home" class="view active">
            <div class="hero" id="hero-box">
                <div class="hero-content">
                    <span class="badge">TRENDING NOW</span>
                    <h1 id="hero-t" class="hero-title">Onyx IPTV</h1>
                    <p id="hero-d" style="color: var(--text-secondary); font-size: 1.3rem; margin: 25px 0; line-height: 1.6;"></p>
                    <button class="btn-premium" style="width: 240px;">â–¶ START WATCHING</button>
                </div>
            </div>
            <div class="row-label">Recommended for You</div>
            <div class="scroller" id="row-tmdb"></div>
            <div class="row-label">Recently Added Movies</div>
            <div class="scroller" id="row-recent"></div>
        </section>

        <!-- CONTENT VIEW (Categories & Items) -->
        <section id="view-content" class="view">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <h1 id="view-title" style="font-size: 3rem; margin: 0;">Library</h1>
                <button class="btn-premium" onclick="navTo('home')" style="width: 120px; margin: 0;">BACK</button>
            </div>
            <div id="content-area" class="category-grid"></div>
        </section>

        <!-- LOGIN VIEW -->
        <section id="view-login" class="view">
            <div class="login-wrap">
                <div class="login-card">
                    <h1 style="margin-top: 0;">Connect</h1>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">Enter your Xtream codes credentials</p>
                    <input type="text" id="url" placeholder="http://server.com:80">
                    <input type="text" id="user" placeholder="Username">
                    <input type="password" id="pass" placeholder="Password">
                    <button class="btn-premium" onclick="connect()">SAVE & CONNECT</button>
                </div>
            </div>
        </section>
    </main>

    <div id="player-layer">
        <video id="v-engine" controls autoplay style="width:100%; height:100%;"></video>
        <button class="btn-premium" onclick="closePlayer()" style="position:fixed; top:30px; left:30px; width:120px; z-index:9999;">CLOSE</button>
    </div>

<script>
    const TMDB_KEY = "c78abeb00aa64f93fd7b516cb9bd180e";
    const PROXY = "https://layasync-proxy.layasync.workers.dev/?url=";
    let auth = null;

    // --- NAVIGATION ---
    async function navTo(page) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        
        const target = document.getElementById('view-' + (page === 'movies' || page === 'shows' ? 'content' : page));
        target.classList.add('active');
        document.getElementById('main-scroller').scrollTop = 0;

        if (page === 'home') initHome();
        if (page === 'movies') loadCategories('get_vod_categories', 'Movies');
        if (page === 'shows') loadCategories('get_series_categories', 'TV Shows');
    }

    // --- XTREAM LOGIC ---
    async function connect() {
        auth = { url: document.getElementById('url').value, user: document.getElementById('user').value, pass: document.getElementById('pass').value };
        const test = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=get_live_categories`));
        if(test.ok) navTo('home');
        else alert("Connection Error");
    }

    async function initHome() {
        // 1. TMDB Spotlight
        const tmdb = await fetch(`https://api.themoviedb.org/3/trending/movie/day?api_key=${TMDB_KEY}`);
        const data = await tmdb.json();
        const top = data.results[0];
        
        document.getElementById('hero-box').style.backgroundImage = `url(https://image.tmdb.org/t/p/original${top.backdrop_path})`;
        document.getElementById('hero-t').innerText = top.title;
        document.getElementById('hero-d').innerText = top.overview;

        // Populate Trending Row
        const rowTmdb = document.getElementById('row-tmdb');
        rowTmdb.innerHTML = '';
        data.results.forEach(m => {
            rowTmdb.appendChild(createCard(`https://image.tmdb.org/t/p/w500${m.backdrop_path}`, m.title, () => {}));
        });

        // 2. Server Recent (If auth)
        if (auth) {
            const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=get_vod_streams`));
            const items = await res.json();
            const rowServer = document.getElementById('row-recent');
            rowServer.innerHTML = '';
            items.slice(0, 15).forEach(i => {
                rowServer.appendChild(createCard(i.stream_icon || i.cover, i.name, () => playItem(i)));
            });
        }
    }

    function createCard(img, title, clickFn) {
        const div = document.createElement('div');
        div.className = 'premium-card';
        div.style.backgroundImage = `url(${img || 'https://via.placeholder.com/300x169/101a23/ffffff?text=No+Image'})`;
        div.innerHTML = `<div class="card-overlay">${title}</div>`;
        div.onclick = clickFn;
        return div;
    }

    // --- CATEGORY ENGINE ---
    async function loadCategories(action, title) {
        document.getElementById('loading').style.display = 'flex';
        document.getElementById('view-title').innerText = title;
        
        const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=${action}`));
        const data = await res.json();
        
        const area = document.getElementById('content-area');
        area.innerHTML = '';
        data.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'cat-item';
            div.innerText = cat.category_name;
            div.onclick = () => loadItems(action.includes('vod') ? 'get_vod_streams' : 'get_series', cat.category_id);
            area.appendChild(div);
        });
        document.getElementById('loading').style.display = 'none';
    }

    async function loadItems(action, catId) {
        document.getElementById('loading').style.display = 'flex';
        const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=${action}&category_id=${catId}`));
        const data = await res.json();
        
        const area = document.getElementById('content-area');
        area.innerHTML = '';
        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'premium-card';
            div.style.width = '100%'; div.style.minWidth = 'unset';
            div.style.backgroundImage = `url(${item.stream_icon || item.cover})`;
            div.innerHTML = `<div class="card-overlay">${item.name}</div>`;
            div.onclick = () => playItem(item);
            area.appendChild(div);
        });
        document.getElementById('loading').style.display = 'none';
    }

    function playItem(item) {
        const url = `${auth.url}/movie/${auth.user}/${auth.pass}/${item.stream_id}.${item.container_extension || 'mkv'}`;
        document.getElementById('player-layer').style.display = 'block';
        const video = document.getElementById('v-engine');
        video.src = url;
        video.play();
    }

    function closePlayer() {
        const video = document.getElementById('v-engine');
        video.pause(); video.src = "";
        document.getElementById('player-layer').style.display = 'none';
    }

    // Init
    setTimeout(() => { document.getElementById('loading').style.display = 'none'; }, 1500);
</script>
</body>
</html>