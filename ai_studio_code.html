<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime IPTV Pro</title>
    <style>
        /* PRIME DESIGN TOKENS */
        :root {
            --bg-deep: #0f171e;
            --bg-nav: #1a242f;
            --prime-blue: #00a8e1;
            --text-main: #ffffff;
            --text-dim: #8197a4;
            --font-stack: "Amazon Ember", "Segoe UI", Roboto, sans-serif;
            --card-w: 280px;
            --card-h: 158px;
        }

        body, html {
            margin: 0; padding: 0; background: var(--bg-deep); color: var(--text-main);
            font-family: var(--font-stack); overflow: hidden; height: 100vh;
        }

        /* SIDEBAR NAVIGATION (Prime Style) */
        aside {
            position: fixed; left: 0; top: 0; bottom: 0; width: 80px;
            background: var(--bg-deep); display: flex; flex-direction: column;
            align-items: center; padding-top: 30px; z-index: 1000;
            border-right: 1px solid rgba(255,255,255,0.05);
        }
        .nav-icon {
            width: 50px; height: 50px; margin-bottom: 25px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            fill: var(--text-dim);
        }
        .nav-icon:hover, .nav-icon.active { fill: var(--prime-blue); background: rgba(255,255,255,0.05); }
        .nav-icon svg { width: 28px; height: 28px; }

        /* MAIN CONTENT AREA */
        main { margin-left: 80px; width: calc(100vw - 80px); height: 100vh; overflow-y: auto; scroll-behavior: smooth; }
        .view { display: none; padding-bottom: 100px; }
        .view.active { display: block; animation: fadeIn 0.6s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* HERO SPOTLIGHT */
        .spotlight {
            height: 80vh; width: 100%; position: relative;
            background-size: cover; background-position: top center;
            display: flex; align-items: center; padding-left: 60px;
        }
        .spotlight::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to right, var(--bg-deep) 15%, transparent 70%),
                        linear-gradient(to top, var(--bg-deep) 5%, transparent 40%);
        }
        .spotlight-content { position: relative; z-index: 10; max-width: 650px; }
        .spotlight-title { font-size: 4rem; font-weight: 800; margin: 0; line-height: 1.1; }
        .spotlight-meta { display: flex; gap: 15px; margin: 20px 0; font-weight: bold; color: #46d369; }

        /* HORIZONTAL ROWS */
        .row-container { margin-top: -150px; position: relative; z-index: 20; padding-left: 60px; }
        .row-title { font-size: 1.4rem; font-weight: 700; margin: 40px 0 15px 0; }
        .row-track { display: flex; gap: 15px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .row-track::-webkit-scrollbar { display: none; }

        /* PRIME CARDS */
        .card {
            min-width: var(--card-w); height: var(--card-h); background: var(--bg-nav);
            border-radius: 4px; position: relative; transition: 0.4s cubic-bezier(0.2, 0, 0.2, 1);
            background-size: cover; background-position: center; flex-shrink: 0;
            border: 3px solid transparent; cursor: pointer;
        }
        .card:hover { transform: scale(1.15); border-color: white; z-index: 100; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }

        /* VIDEO PLAYER OVERLAY */
        #player-layer {
            position: fixed; inset: 0; background: #000; z-index: 5000; display: none;
        }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* INPUTS & LOGIN */
        .login-screen { display: flex; align-items: center; justify-content: center; height: 100vh; }
        .login-card { background: var(--bg-nav); padding: 50px; border-radius: 8px; width: 400px; }
        input { 
            width: 100%; padding: 15px; margin: 10px 0; background: #2a3744; 
            border: 1px solid #3f4e5e; color: white; border-radius: 4px; box-sizing: border-box;
        }
        .btn-prime { 
            width: 100%; padding: 15px; background: var(--prime-blue); color: white; 
            border: none; font-weight: 700; cursor: pointer; border-radius: 4px; margin-top: 20px;
        }

        .loader { position: fixed; inset: 0; background: var(--bg-deep); z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <aside id="sidebar">
        <div class="nav-icon active" onclick="showPage('home')" title="Home">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        </div>
        <div class="nav-icon" onclick="showPage('movies')" title="Movies">
            <svg viewBox="0 0 24 24"><path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/></svg>
        </div>
        <div class="nav-icon" onclick="showPage('shows')" title="TV Shows">
            <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"/></svg>
        </div>
        <div class="nav-icon" onclick="showPage('login')" title="Settings">
            <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
        </div>
    </aside>

    <div id="loader" class="loader"><h1>Connecting to Prime...</h1></div>

    <main>
        <!-- HOME VIEW -->
        <section id="view-home" class="view active">
            <div class="spotlight" id="spotlight">
                <div class="spotlight-content">
                    <h1 id="spot-title" class="spotlight-title">Loading...</h1>
                    <div class="spotlight-meta">⭐ <span id="spot-rating">0.0</span> | <span id="spot-year">2024</span> | UHD</div>
                    <p id="spot-desc" style="color:var(--text-dim); font-size:1.2rem; line-height:1.5;"></p>
                    <button class="btn-prime" style="width:200px">▶ Watch Now</button>
                </div>
            </div>

            <div class="row-container">
                <div class="row-title">Recently Added on Server</div>
                <div class="row-track" id="row-server"></div>

                <div class="row-title">Trending Globally</div>
                <div class="row-track" id="row-trending"></div>
            </div>
        </section>

        <!-- CATEGORY LIST (Movies/Shows) -->
        <section id="view-cats" class="view">
            <h1 style="padding: 100px 60px 20px;" id="cat-title">Categories</h1>
            <div id="cat-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:20px; padding:0 60px;"></div>
        </section>

        <!-- LOGIN SCREEN -->
        <section id="view-login" class="view">
            <div class="login-screen">
                <div class="login-card">
                    <h2 style="color: var(--prime-blue)">Setup Xtream Account</h2>
                    <input type="text" id="iptv_url" placeholder="http://server.com:80">
                    <input type="text" id="iptv_user" placeholder="Username">
                    <input type="password" id="iptv_pass" placeholder="Password">
                    <button class="btn-prime" onclick="connect()">CONNECT SERVER</button>
                </div>
            </div>
        </section>
    </main>

    <!-- FULLSCREEN VIDEO LAYER -->
    <div id="player-layer">
        <video id="main-video" controls autoplay></video>
        <button class="btn-prime" onclick="closePlayer()" style="position:fixed; top:20px; left:20px; width:100px;">Back</button>
    </div>

<script>
    const TMDB_KEY = "c78abeb00aa64f93fd7b516cb9bd180e";
    const PROXY = "https://layasync-proxy.layasync.workers.dev/?url=";
    let auth = null;

    function showPage(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
        
        if (id === 'movies') loadCategories('get_vod_categories');
        if (id === 'shows') loadCategories('get_series_categories');
    }

    async function connect() {
        auth = {
            url: document.getElementById('iptv_url').value,
            user: document.getElementById('iptv_user').value,
            pass: document.getElementById('iptv_pass').value
        };
        document.getElementById('loader').style.display = 'flex';
        // Validate
        const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=get_live_categories`));
        if (res.ok) {
            initHome();
            showPage('home');
        }
        document.getElementById('loader').style.display = 'none';
    }

    async function initHome() {
        // 1. Fetch TMDB Trending for Spotlight
        const tmdb = await fetch(`https://api.themoviedb.org/3/trending/movie/week?api_key=${TMDB_KEY}`);
        const data = await tmdb.json();
        const top = data.results[0];
        
        document.getElementById('spotlight').style.backgroundImage = `url(https://image.tmdb.org/t/p/original${top.backdrop_path})`;
        document.getElementById('spot-title').innerText = top.title;
        document.getElementById('spot-rating').innerText = top.vote_average.toFixed(1);
        document.getElementById('spot-desc').innerText = top.overview;

        fillRow('row-trending', data.results);

        // 2. Fetch Server Recently Added
        const server = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=get_vod_streams`));
        const sData = await server.json();
        fillRow('row-server', sData.slice(0, 20), true);
    }

    function fillRow(id, items, isServer = false) {
        const row = document.getElementById(id);
        row.innerHTML = '';
        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            const img = isServer ? (item.stream_icon || item.cover) : `https://image.tmdb.org/t/p/w500${item.backdrop_path}`;
            card.style.backgroundImage = `url(${img})`;
            card.onclick = () => isServer ? playStream(item) : console.log("TMDB Clicked");
            row.appendChild(card);
        });
    }

    async function loadCategories(action) {
        document.getElementById('loader').style.display = 'flex';
        const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=${action}`));
        const data = await res.json();
        const grid = document.getElementById('cat-grid');
        grid.innerHTML = '';
        data.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'card';
            div.style.width = '100%';
            div.innerHTML = `<div style="height:100%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${cat.category_name}</div>`;
            div.onclick = () => loadCategoryItems(action.includes('vod') ? 'get_vod_streams' : 'get_series', cat.category_id);
            grid.appendChild(div);
        });
        document.getElementById('cat-title').innerText = action.includes('vod') ? "Movie Categories" : "Show Categories";
        showPage('cats');
        document.getElementById('loader').style.display = 'none';
    }

    async function loadCategoryItems(action, id) {
        document.getElementById('loader').style.display = 'flex';
        const res = await fetch(PROXY + encodeURIComponent(`${auth.url}/player_api.php?username=${auth.user}&password=${auth.pass}&action=${action}&category_id=${id}`));
        const data = await res.json();
        const grid = document.getElementById('cat-grid');
        grid.innerHTML = '';
        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.style.width = '100%';
            div.style.backgroundImage = `url(${item.stream_icon || item.cover})`;
            div.onclick = () => playStream(item);
            grid.appendChild(div);
        });
        document.getElementById('loader').style.display = 'none';
    }

    function playStream(item) {
        const player = document.getElementById('player-layer');
        const video = document.getElementById('main-video');
        const ext = item.container_extension || 'mkv';
        // Construct Xtream URL
        const streamUrl = `${auth.url}/movie/${auth.user}/${auth.pass}/${item.stream_id}.${ext}`;
        
        player.style.display = 'block';
        video.src = streamUrl;
        video.play();
    }

    function closePlayer() {
        const video = document.getElementById('main-video');
        video.pause();
        document.getElementById('player-layer').style.display = 'none';
    }

    // Loader timeout
    setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
</script>
</body>
</html>